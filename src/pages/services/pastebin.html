<?php
    Upvote::render_arrows(
        "pastebin",
        "defuse_pages",
        "PIE Bin",
        "An pastebin with both client-side and server-side encryption.",
        "https://defuse.ca/pastebin.htm"
    );
?>
<center><img style="margin-bottom: 10px;" src="/images/secure_pastebin.png" alt="Secure, Encrypted, Anonymous Pastebin. PIE - Pre Internet Encryption" /></center>

<div style="text-align:center; font-size: 20px;"><b><u>P</u></b>re-<b><u>I</u></b>nternet <b><u>E</u></b>ncryption for Text</div>

<form id="pasteform" name="pasteform" action="/bin/add.php" method="post">
	<input id="jscrypt" type="hidden" name="jscrypt" value="no" />
	<br />
	<textarea id="paste" style="color:black; background-color:white; border:dashed 1px black; width:100%;" rows="30" cols="40" name="paste" spellcheck="false"></textarea>
	<br />
	<p><b>All posts are automatically deleted after 10 days.</b></p>
    <input style="width:300px;" type="submit" name="submitpaste" value="Post Without Password Encryption" /> 	<input type="checkbox" name="shorturl" value="yes" /> Use shorter URL.
     Expire in
     <select name="lifetime">
         <option value="15552000">6 Months</option>
         <option value="2592000">30 Days</option>
         <option value="864000" selected="selected">10 Days</option>
         <option value="86400">1 Day</option>
         <option value="3600">60 Minutes</option>
         <option value="600">10 Minutes</option>
     </select>
</form>


<!--Client-side encryption options-->
<noscript><p style="color: #550000;"><b>JavaScript is required to use client-side encryption.</b></p></noscript>
<div id="encinfo" style="margin-top: 10px;">
	Client-Side Password: 
	<input type="password" id="pass1" value="" /> &nbsp;
	Verify: <input type="password" id="pass2" value="" /> 
	<input type="button" value="Encrypt &amp; Post" onclick="encryptPaste()" />
</div> <!-- /enc -->
<!--end of client-side encryption options-->

<!-- Scripts for client-side encryption -->
<script type="text/javascript" src="/js/sjcl.js"></script>
<script type="text/javascript" src="/js/encrypt.js"></script>

<script type="text/javascript">
<!--

/* Use server-side code to fill this with a random 256 bit hex string. */
var entropy = "<?php echo bin2hex(mcrypt_create_iv(32, MCRYPT_DEV_URANDOM)); ?>";
sjcl.random.addEntropy(entropy, entropy.length * 4, "server");

/* Collect entropy from mouse movements and key-presses */
try {
    sjcl.random.startCollectors();
} catch (e) {
    /* Ignore it -- server entropy is good enough. */
}

function encryptPaste()
{
	var pass1 = document.getElementById("pass1").value;
	var pass2 = document.getElementById("pass2").value;
	if(pass1 == pass2 && pass1 != "")
	{
		var plain = document.getElementById("paste").value;
		var ct = encrypt.encrypt(pass1, plain);
		document.getElementById("paste").value = ct;
		document.getElementById("jscrypt").value = "yes";
		document.pasteform.submit();
	}
	else if(pass1 != pass2)
	{
		alert("Passwords do not match.");
	}
	else if(pass1 == "")
	{
		alert("You must provide a password.");
	}
}
-->
</script>
<!-- End of scripts for client-side encryption -->
<a name="security"></a>
<h2>Security &amp; Encryption Details</h2>

<p>
Pastebins are useful for sending large amounts of text over Twitter or IM, but
the most popular ones do not provide security. Posts on "pastebin.com" are
indexed by search engines, and anyone can search through your pastes. You can
<a href="https://encrypted.google.com/search?q=%22BEGIN%2bRSA%2bPRIVATE%2bKEY%22%2b%2bsite%3Apastebin.com" rel="nofollow">search for private keys</a>.
This pastebin aims to protect your data as much as possible, while still being
as easy to use as other pastebin services.
</p>

<p>
The text you paste here will be encrypted and sent over an SSL/TLS connection so
that it will never be seen by anyone unless they know the URL and, if one was
used, the client-side password. If someone gains full root access to the server,
they will not be able to decrypt existing pastes, but <em>can</em> access new
ones before they are encrypted. In other words, pastes are secure if and only if
the server had not been compromised before they were created. If we get a court
order to decrypt a post, we will not be able to comply.
</p>

<p>
<b>For maximum security, always use a strong client-side password.</b>
</p>

<p>
We have a <a href="/robots.txt">robots.txt</a> entry to tell search engines not
to index pastes. This helps prevent pastes from showing up in search engine
results. However, search engines can ignore robots.txt, so this is not
guaranteed.
</p>

<p>
If logging were enabled on the server, then the pastebin URLs would be written
to the log file and the system administrator could see the pastes. For this
reason, access logging is disabled on the server. If access logging must be
enabled for whatever reason, there are rules in place to ensure requests with
pastebin URLs or Referers are not logged.
</p>

<p>
Here's a diagram of the encryption process:
</p>

<center>
    <b><u>PIE BIN Encryption Process:</u></b>
    <br /><br />
    <img src="/images/pastebin-diagram.png" alt="Secure Pastebin Data Flow Diagram" title="Secure Pastebin Crypto" />
</center>

